<!doctype html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="write something useful">
<meta property="og:type" content="website">
<meta property="og:title" content="Duncan's Blog">
<meta property="og:url" content="https://github.com/DuncanZhou/page/2/index.html">
<meta property="og:site_name" content="Duncan's Blog">
<meta property="og:description" content="write something useful">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Duncan's Blog">
<meta name="twitter:description" content="write something useful">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/DuncanZhou/page/2/"/>





  <title> Duncan's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Duncan's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/06/13/Alogorithms_Learning/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/13/Alogorithms_Learning/" itemprop="url">
                  求最优解算法学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-13T20:16:12+08:00">
                2017-06-13
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简要"><a href="#简要" class="headerlink" title="简要"></a>简要</h3><p>本篇主要记录三种求最优解的算法:<strong>动态规划(dynamic programming)</strong>,<strong>贪心算法</strong>和<strong>平摊分析</strong>.</p>
<h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><p>1.动态规划是通过组合子问题的解而解决整个问题的.分治法算法是指将问题划分成一些<font color="red">独立</font>的子问题, <font color="red">递归地求解</font>各个子问题,然后<font color="red">合并子问题的解</font>而得到原问题的解.与此不同,动态规划适用于<font color="red">子问题不是独立</font>的情况,也就是各个子问题包含公共的子子问题.在这种情况下,若用分治法则会做许多不必要的工作,即重复地求解公共的子子问题.</p>
<p>动态规划算法的设计可以分为以下四个步骤:</p>
<blockquote>
<p>1.描述最优解的结构<br>2.递归定义最优解的值<br>3.按自底向上的方式计算最优解的值<br>4.由计算出的结果构造一个最优解</p>
</blockquote>
<p><font color="red"><strong>能否运用动态规划方法的标志之一:</strong></font>一个问题的最优解包含了子问题的一个最优解.这个性质为最优子结构.</p>
<p>适合采用动态规划的最优化问题的两个要素:<font color="red"><strong>最优子结构</strong></font>和<font color="red"><strong>重叠子问题</strong></font></p>
<h3 id="贪心算法"><a href="#贪心算法" class="headerlink" title="贪心算法"></a>贪心算法</h3><p>1.贪心算法是使所做的选择看起来都是当前最佳的,期望通过所做的局部最优选择来产生出一个全局最优解.</p>
<p>2.贪心算法的每一次操作都对结果产生直接影响,而动态规划不是.贪心算法对每个子问题的解决方案做出选择,不能回退;动态规划则会根据之前的选择结果对当前进行选择,有回退功能.动态规划主要运用于二维或三维问题,而贪心一般是一维问题.</p>
<p>3.贪心算法要经过证明才能运用到算法中.</p>
<h3 id="平摊分析"><a href="#平摊分析" class="headerlink" title="平摊分析"></a>平摊分析</h3><p>(未完-待续)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/06/07/RecommendationLearning/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/07/RecommendationLearning/" itemprop="url">
                  Recommendation方向学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-07T16:12:49+08:00">
                2017-06-07
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h3><p>目前推荐上研究的方向有这样几个方向:<br>1.Temporal Context-Aware Recommendation<br>2.Spatial Recommendation for Out-of-Town Users<br>3.Location-based and Real-time Recommendation<br>4.Efficiency of Online Recommendation</p>
<p>补充学习:</p>
<blockquote>
<p>online learning强调的是学习是实时的，流式的，每次训练不用使用全部样本，而是以之前训练好的模型为基础，每来一个样本就更新一次模型，这种方法叫做OGD（online gradient descent）。</p>
<p>batch learning或者叫offline learning强调的是每次训练都需要使用全量的样本，因而可能会面临数据量过大的问题。</p>
</blockquote>
<p>传统的推荐系统广泛都使用了<font color="blue">协同过滤</font>和<font color="blue">基于内容过滤技术</font></p>
<p>协同过滤分为</p>
<blockquote>
<p>基于内存的推荐和基于模型的推荐(矩阵分解)</p>
</blockquote>
<p>Context-Aware Recommender Systems(CARS)包含三种范例:contextual pre-filtering,contextual post-filtering and contextual modeling.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/05/25/RESTful-web-service/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/25/RESTful-web-service/" itemprop="url">
                  RESTful web service
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-25T20:32:39+08:00">
                2017-05-25
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>REST架构就是为了HTTP协议设计的。RESTful web services的核心概念是管理资源。资源是由URIs来表示，客户端使用HTTP当中的’POST, OPTIONS, GET, PUT, DELETE’等方法发送请求到服务器，改变相应的资源状态。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">==========  ===============================================  =============================</div><div class="line">HTTP 方法   URL                                              动作</div><div class="line">==========  ===============================================  ==============================</div><div class="line">GET         http://[hostname]/todo/api/v1.0/tasks            检索任务列表</div><div class="line">GET         http://[hostname]/todo/api/v1.0/tasks/[task_id]  检索某个任务</div><div class="line">POST        http://[hostname]/todo/api/v1.0/tasks            创建新任务</div><div class="line">PUT         http://[hostname]/todo/api/v1.0/tasks/[task_id]  更新任务</div><div class="line">DELETE      http://[hostname]/todo/api/v1.0/tasks/[task_id]  删除任务</div><div class="line">==========  ================================================ =============================</div></pre></td></tr></table></figure></p>
<p>参见该地址</p>
<blockquote>
<p><a href="http://www.pythondoc.com/flask-restful/first.html" target="_blank" rel="external">http://www.pythondoc.com/flask-restful/first.html</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/05/23/apoc-introduction/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/23/apoc-introduction/" itemprop="url">
                  apoc-introduction
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-23T10:09:04+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>1.github下载链接:<a href="https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/3.1.2.5">https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/3.1.2.5</a><br>(对应neo-4j版本下载相应的apoc jar包,并将jar包置于neo4j的plugins下.</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>开发文档</p>
<blockquote>
<p>github地址:<a href="https://neo4j-contrib.github.io/neo4j-apoc-procedures/" target="_blank" rel="external">https://neo4j-contrib.github.io/neo4j-apoc-procedures/</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/05/22/OpenMPILearning/OpenMPILearning/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/22/OpenMPILearning/OpenMPILearning/" itemprop="url">
                  OpenMPI学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-22T12:07:54+08:00">
                2017-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>由于学校服务器上不允许随便装其他环境，所以用自己pc跑了程序.<br>学校服务器配置:10台物理机 每台机子2个核<br>PC:4核</p>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>1.OpenMPI<br>2.Python环境<br>3.nltk包安装<br>4.numpy环境<br>5.mpi4py</p>
<h3 id="代码程序"><a href="#代码程序" class="headerlink" title="代码程序"></a>代码程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line">#-*-coding:utf-8-*-</div><div class="line">&apos;&apos;&apos;@author:duncan&apos;&apos;&apos;</div><div class="line">import re</div><div class="line">import os</div><div class="line">import math</div><div class="line">import time</div><div class="line">import sys</div><div class="line">reload(sys)</div><div class="line">sys.setdefaultencoding(&apos;utf-8&apos;)</div><div class="line">import nltk</div><div class="line">from nltk.tokenize import word_tokenize</div><div class="line">from nltk.corpus import stopwords</div><div class="line">from nltk.stem import WordNetLemmatizer</div><div class="line">from mpi4py import MPI</div><div class="line">tweets_path = &apos;TestTweets/&apos;</div><div class="line"></div><div class="line">tags = 10</div><div class="line"></div><div class="line"></div><div class="line"># 公共通信变量</div><div class="line">comm = MPI.COMM_WORLD</div><div class="line"># 当前进程获取当前进程的id</div><div class="line">comm_rank = comm.Get_rank()</div><div class="line"># 获取整个通信结点的数量</div><div class="line">comm_size = comm.Get_size()</div><div class="line"></div><div class="line"># 计算一段文本中的tags,返回tag列表</div><div class="line">def GetTags(text):</div><div class="line">    twitter_stop_words = [&quot;from&quot;,&quot;TO&quot;,&quot;to&quot;,&quot;https&quot;,&quot;RT&quot;,&quot;URL&quot;,&quot;in&quot;,&quot;re&quot;,&quot;thank&quot;,&quot;thanks&quot;,&quot;today&quot;,&quot;yesterday&quot;,&quot;tomorrow&quot;,&quot;night&quot;,&quot;tonight&quot;,&quot;day&quot;,&quot;year&quot;,&quot;last&quot;,&quot;oh&quot;,&quot;yeah&quot;,&quot;amp&quot;]</div><div class="line">    &apos;&apos;&apos;</div><div class="line"></div><div class="line">    :param text: 文本</div><div class="line">    :return: 返回tag列表</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    # 首先针对推文中去除其他符号</div><div class="line">    text = re.sub(r&apos;[@|#][\d|\w|_]+|http[\w|:|.|/|\d]+&apos;,&quot;&quot;,text)</div><div class="line">    wordslist = []</div><div class="line">    if text == &quot;&quot; or text == None:</div><div class="line">        return []</div><div class="line"></div><div class="line">    # 利用nltk分词</div><div class="line">    words = word_tokenize(text)</div><div class="line">    for word in words:</div><div class="line">        # 去除停用词</div><div class="line">        if word not in (stopwords.words(&quot;english&quot;) and twitter_stop_words):</div><div class="line">            if(len(word) &gt; 2 and word.isalpha()):</div><div class="line">                wordslist.append(word.lower())</div><div class="line">    # 继续对词性进行标注</div><div class="line">    try:</div><div class="line">        pos = nltk.pos_tag(wordslist)</div><div class="line">    except Exception as e:</div><div class="line">        pos = []</div><div class="line">    if(len(pos) &lt; 1):</div><div class="line">        return []</div><div class="line">    tags = []</div><div class="line">    lemmatizer = WordNetLemmatizer()</div><div class="line">    for w in pos:</div><div class="line">        word = &quot;&quot;</div><div class="line">        # 是动词,做词性还原</div><div class="line">        if(w[1][0] == &apos;V&apos;):</div><div class="line">            word = lemmatizer.lemmatize(w[0],&apos;v&apos;)</div><div class="line">            tags.append(word)</div><div class="line">        # 是名词做词性还原</div><div class="line">        elif(w[1][0] == &quot;N&quot;):</div><div class="line">            word = lemmatizer.lemmatize(w[0])</div><div class="line">            tags.append(word)</div><div class="line">    i = 0</div><div class="line">    multicandidates = []</div><div class="line">    while(i &lt; len(pos) - 2):</div><div class="line">        phase = &quot;&quot;</div><div class="line">        # 动名词 | 动词 + 形容词 +名词</div><div class="line">        if (pos[i])[1][0] == &apos;V&apos; and (pos[i + 1][1][0] == &apos;N&apos; or (pos[i + 1][1][0] == &quot;J&quot; and pos[i + 2][1][0] == &quot;N&quot;)):</div><div class="line">            if pos[i + 1][1][0] == &apos;N&apos;:</div><div class="line">                suffix = lemmatizer.lemmatize(pos[i + 1][0],&apos;a&apos;)</div><div class="line">            else:</div><div class="line">                suffix = lemmatizer.lemmatize(pos[i + 1][0],&apos;n&apos;)</div><div class="line">            phase += lemmatizer.lemmatize((pos[i])[0],&apos;v&apos;) + &quot; &quot; + suffix</div><div class="line">            i = i + 2</div><div class="line">            while(i &lt; len(pos) and (pos[i])[1][0] == &apos;N&apos;):</div><div class="line">                phase += &quot; &quot; + lemmatizer.lemmatize((pos[i])[0])</div><div class="line">                i += 1</div><div class="line"></div><div class="line">            multicandidates.append(phase)</div><div class="line">        # 形容词　+ 名词</div><div class="line">        elif(pos[i][1][0] == &quot;J&quot; and pos[i + 1][1][0] == &quot;N&quot;):</div><div class="line">            if((i !=0 and pos[i - 1 ][1][0] != &quot;V&quot;) or i == 0):</div><div class="line">                phase +=lemmatizer.lemmatize((pos[i])[0],&quot;a&quot;) + &quot; &quot; + lemmatizer.lemmatize((pos[i + 1])[0])</div><div class="line">                i += 2</div><div class="line">                while(i &lt; len(pos) and (pos[i])[1][0] == &apos;N&apos;):</div><div class="line">                    phase += &quot; &quot; + lemmatizer.lemmatize((pos[i])[0],&quot;n&quot;)</div><div class="line">                    i += 1</div><div class="line">            multicandidates.append(phase)</div><div class="line">        else:</div><div class="line">            i += 1</div><div class="line">    if len(multicandidates) != 0:</div><div class="line">        tags += multicandidates</div><div class="line">    return tags</div><div class="line"></div><div class="line"></div><div class="line"># 计算words列表中词频</div><div class="line">def CalcTF(words,number):</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    :param number: 限制返回的tag数量</div><div class="line">    :param words: 传入words的list列表</div><div class="line">    :return: 返回对应字典形式 &#123;tag:TF&#125;,最终返回列表</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    worddic = &#123;&#125;</div><div class="line">    # 先转换成集合</div><div class="line">    dic = set(words)</div><div class="line">    for word in dic:</div><div class="line">        TF = words.count(word)</div><div class="line">        worddic[word] = TF</div><div class="line">    # 将字典按照词频排序,取前10个</div><div class="line">    worddic = sorted(worddic.items(),key = lambda val:val[1],reverse=True)</div><div class="line">    return worddic[:number]</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    # text = &quot;how do i love you? Beautiful girls like eating cakes. I like dancing and swimming. How about you?he loves me? all we eat cakes.&quot;</div><div class="line">    # print CalcTF(GetTags(text),10)</div><div class="line"></div><div class="line">    flag = False</div><div class="line">    # 获取文件夹中用户总数及名称</div><div class="line">    names_list = os.listdir(tweets_path)</div><div class="line">    users_number = len(names_list)</div><div class="line">    if(comm_rank == 0):</div><div class="line">        print &quot;共%d个用户&quot; % users_number</div><div class="line">    block_size = math.ceil(users_number * 1.0 / comm_size)</div><div class="line">    # print &quot;block_size大小%d&quot; % block_size</div><div class="line">    start = i = int(comm_rank * block_size)</div><div class="line">    users_tags = []</div><div class="line">    start_time = time.time()</div><div class="line">    while(i &lt; block_size + start and i &lt; users_number):</div><div class="line">        with open(tweets_path + names_list[i],&apos;r&apos;) as f:</div><div class="line">            text = f.read()</div><div class="line">        # 得到某一用户的前n个tags,并有词频</div><div class="line">        user_tags = CalcTF(GetTags(text.decode(&quot;utf-8&quot;)),tags)</div><div class="line">        # print user_tags</div><div class="line">        users_tags += user_tags</div><div class="line">        i += 1</div><div class="line">        print &quot;已处理%d个用户&quot; % i</div><div class="line"></div><div class="line">    if(comm_rank == 0):</div><div class="line">        i = 1</div><div class="line">        while(i &lt; comm_size):</div><div class="line">            rev_tags = comm.recv(source=i)</div><div class="line">            # 合并起来</div><div class="line">            users_tags += rev_tags</div><div class="line">            i += 1</div><div class="line">            # print users_tags</div><div class="line">        # 写入文件</div><div class="line">        with open(&quot;/home/duncan/tags_tf&quot;,&quot;w&quot;) as f:</div><div class="line">            # 使得从第一行开始写</div><div class="line">            for tag in users_tags:</div><div class="line">                f.write(tag[0])</div><div class="line">                f.write(&quot;\t&quot;)</div><div class="line">                f.write(str(tag[1]))</div><div class="line">                f.write(&quot;\n&quot;)</div><div class="line">        print &quot;TF值写入完成&quot;</div><div class="line">        # 当对文件写入完成时发送广播</div><div class="line">        flag = True</div><div class="line">        comm.bcast(flag,root=0)</div><div class="line">    else:</div><div class="line">        # 除了0号进程外,其他进程发送数据,先发送自己的进程id</div><div class="line">        comm.send(users_tags,dest=0)</div><div class="line"></div><div class="line">    if(comm_rank != 0):</div><div class="line">        flag = comm.bcast(None,root=0)</div><div class="line"></div><div class="line">    # 当flag为True时继续向下计算</div><div class="line">    if(flag == True):</div><div class="line">        print &quot;process %d 开始计算idf&quot; % comm_rank</div><div class="line">        # 对保存好的文件中的TF词频tags继续计算IDF</div><div class="line">        with open(&quot;/home/duncan/tags_tf&quot;,&quot;r&quot;) as f:</div><div class="line">            lines = f.readlines()</div><div class="line">        # 每个进程结点需要处理的tags数</div><div class="line">        block_size = (int)(math.ceil(users_number * 1.0 / comm_size)) * tags</div><div class="line">        start = lineid = comm_rank * block_size</div><div class="line">        tags_tfidf = []</div><div class="line">        while(lineid &lt; block_size + start and lineid &lt; users_number * tags):</div><div class="line"></div><div class="line">            # 对lines[i]去计算它的idf,在其他用户tags中搜寻</div><div class="line">            user_id = int(math.ceil((lineid + 1) * 1.0 / tags))</div><div class="line">            # 所以该用户tags行标在[(user_id - 1) * tags,user_id * tags - 1]</div><div class="line">            search_rowid = 0</div><div class="line">            count = 1</div><div class="line">            while(search_rowid &lt; users_number * tags):</div><div class="line">                # 当在其中一个用户的tags中搜寻到后直接跳至下一个用户的tags</div><div class="line">                if(search_rowid &lt; (user_id - 1) * tags or search_rowid &gt; user_id * tags - 1):</div><div class="line">                    if((lines[search_rowid].split(&quot;\t&quot;))[0] == (lines[lineid].split(&quot;\t&quot;))[0]):</div><div class="line">                        count += 1</div><div class="line">                        # 跳到下一个用户tags开始处</div><div class="line">                        current_user_id = int(math.ceil((search_rowid + 1) * 1.0 / tags))</div><div class="line">                        search_rowid = current_user_id * tags</div><div class="line">                    else:</div><div class="line">                        search_rowid += 1</div><div class="line">                else:</div><div class="line">                    # 在所需要判断的用户的tags范围内,则跳出</div><div class="line">                    search_rowid = user_id * tags</div><div class="line">            idf = math.log(users_number * 1.0 / count,2)</div><div class="line">            # print count,idf</div><div class="line">            tags_tfidf.append(((lines[lineid].split(&quot;\t&quot;))[0],idf * int((lines[lineid].split(&quot;\t&quot;))[1])))</div><div class="line">            lineid += 1</div><div class="line"></div><div class="line">        end_time = time.time()</div><div class="line">        # 每个结点都处理完自己的用户推文</div><div class="line">        print &quot;process %d cost %f&quot; % (comm_rank,end_time - start_time)</div><div class="line"></div><div class="line">        # 该进程计算完其下所有用户的tags的tfidf</div><div class="line">        if(comm_rank == 0):</div><div class="line">            # 收集tags_tfidf</div><div class="line">            i = 1</div><div class="line">            while(i &lt; comm_size):</div><div class="line">                recv_tags = comm.recv(source = i)</div><div class="line">                tags_tfidf += recv_tags</div><div class="line">                i += 1</div><div class="line">            # 最终结果写入文件</div><div class="line">            with open(&quot;/home/duncan/tags_tfidf&quot;,&quot;w&quot;) as f:</div><div class="line">                for tag in tags_tfidf:</div><div class="line">                    f.write(tag[0])</div><div class="line">                    f.write(&quot;\t&quot;)</div><div class="line">                    f.write(str(tag[1]))</div><div class="line">                    f.write(&quot;\n&quot;)</div><div class="line">        else:</div><div class="line">            comm.send(tags_tfidf,dest=0)</div></pre></td></tr></table></figure>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p>1.48个用户,每个用户10个标签  加速比1.6左右(单核:365s;4核:226s)<br>3.100个用户,每个用户10个标签,加速比1.7左右(单核:781s;4核:457s)<br>3.1000个用户,每个用户10个标签,加速比(1.8左右)(单核:5706s;4核:3108s)<br>4.10000个用户,每个用户10个标签,加速比(2左右)(单核:69299s;4核:34643s)<br><img src="http://ww4.sinaimg.cn/large/006HJ39wgy1fftzigg1rxj30m80go0t5.jpg" alt="实验结果图"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/05/22/OpenMPILearning-1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/22/OpenMPILearning-1/" itemprop="url">
                  OpenMPILearning
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-22T11:22:12+08:00">
                2017-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/05/20/pip_changeSource/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/20/pip_changeSource/" itemprop="url">
                  pip安装包更换pypi源
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-20T16:33:28+08:00">
                2017-05-20
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用豆瓣源</p>
<blockquote>
<p>sudo pip install #package -i <a href="http://pypi.douban.com.simple" target="_blank" rel="external">http://pypi.douban.com.simple</a> –trusted-host pypi.douban.com</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/05/16/No-Root Install mpi4py/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/16/No-Root Install mpi4py/" itemprop="url">
                  在非root用户下安装mpi4py
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-16T09:52:51+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="step1"><a href="#step1" class="headerlink" title="step1:"></a>step1:</h3><p>安装mpi4py所需要的依赖包(python2.7版本/Cpython/Openmpi)<br>1.源码包安装Python2.7版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">./configure prefix=&quot;#python安装目录(绝对路径)&quot;</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<p>2.安装Cpython<br>使用当前用户目录下的python版本来进行安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/home/XXX/python27/bin/python setup.py install</div></pre></td></tr></table></figure></p>
<p>3.安装openmpi<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">./configure prefix=&quot;#openmpi安装目录(绝对路径)&quot;</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<h3 id="step3"><a href="#step3" class="headerlink" title="step3:"></a>step3:</h3><p>配置openmpi环境变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim ~/.bashrc</div><div class="line"># ~/.bashrc末尾添加</div><div class="line">export PATH=#openmpi的绝对路径/bin:$PATH</div><div class="line">soucre ~/.bashrc</div></pre></td></tr></table></figure></p>
<h3 id="step4"><a href="#step4" class="headerlink" title="step4:"></a>step4:</h3><p>安装mpi4py包(同Cpython包安装方法)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/home/XXX/python27/bin/python setup.py install</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/05/11/neo4j-developer-document/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/11/neo4j-developer-document/" itemprop="url">
                  neo4j官方开发文档阅读记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-11T21:09:13+08:00">
                2017-05-11
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>重新选择neo-4j官方的与python交互包，尝试了py2neo包后发现对neo4j了解还不够，很多操作只是浅尝辄止，所以，决定阅读neo4j的官方开发驱动包，并尝试学习Cypher语言，这对以后对人物关系的挖掘是有帮助的．</p>
</blockquote>
<h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h3><p>neo-4j由两部分组成:relationship,label和property,label或者relationship中包含property,label与label之间形成关系.</p>
<h3 id="2-语法"><a href="#2-语法" class="headerlink" title="2.语法"></a>2.语法</h3><font color="red">2.1 Node语法</font><br>Cypher语言用()代表一个节点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">()</div><div class="line">(matrix)</div><div class="line">(matrix:Movie)</div><div class="line">(matrix:Movie&#123;title:&quot;The Matrix&quot;,released:1997&#125;)</div></pre></td></tr></table></figure><br><br><font color="red">2.2 Relationship语法</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">--&gt;</div><div class="line">-[role]-&gt;</div><div class="line">-[:ACTED_IN]-&gt;</div><div class="line"># 关系的类型</div><div class="line">-[role:ACTED_IN]-&gt;</div><div class="line"># 关系的属性值,属性值可以是数组</div><div class="line">-[role:ACTED_IN &#123;role:[&quot;Neo&quot;]&#125;]-&gt;</div></pre></td></tr></table></figure><br><br><font color="red">2.3 Pattern语法</font><br>语法中有Node和Relationship<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(keanu:Person:Actor &#123;name:&quot;Keanu Reeves&quot;&#125;)</div><div class="line">-[role:ACTED_IN &#123;roles:[&quot;Neo&quot;]&#125;]-&gt;</div><div class="line">(matrix:Movie &#123;title:&quot;The matrix&quot;&#125;)</div></pre></td></tr></table></figure><br><br>保存结点关系path<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># acted_in中保存的就是path,有很多函数可以对path操作:nodes(path),rels(paht),len(path)</div><div class="line">acted_in = (:Person)-[:ACTED_IN]-&gt;(:Movie)</div></pre></td></tr></table></figure><br><br>创建数据及及结点关系<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CREATE (:MOVIE &#123;title:&quot;The Matrix&quot;,released:1997&#125;)</div><div class="line">CREATE (p:Person &#123; name:&quot;Keanu Reeves&quot;, born:1964 &#125;)</div><div class="line">RETURN p</div><div class="line"># 创建关系</div><div class="line">CREATE (a:Person &#123; name:&quot;Tom Hanks&quot;,</div><div class="line">  born:1956 &#125;)-[r:ACTED_IN &#123; roles: [&quot;Forrest&quot;]&#125;]-&gt;(m:Movie &#123; title:&quot;Forrest Gump&quot;,released:1994 &#125;)</div><div class="line">CREATE (d:Person &#123; name:&quot;Robert Zemeckis&quot;, born:1951 &#125;)-[:DIRECTED]-&gt;(m)</div><div class="line">RETURN a,d,r,m</div></pre></td></tr></table></figure><br><br>匹配pattern<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MATCH(m:Movie)</div><div class="line">RETURN m</div><div class="line">MATCH(p:Person &#123;name:&quot;duncan&quot;&#125;)</div><div class="line">RETURN p</div><div class="line"># 匹配关系</div><div class="line">MATCH (p:Person &#123; name:&quot;Tom Hanks&quot; &#125;)-[r:ACTED_IN]-&gt;(m:Movie)</div><div class="line">RETURN m.title, r.roles</div></pre></td></tr></table></figure><br><br>添加节点并添加关系<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MATCH (p:Person &#123; name:&quot;Tom Hanks&quot; &#125;)</div><div class="line">CREATE (m:Movie &#123; title:&quot;Cloud Atlas&quot;,released:2012 &#125;)</div><div class="line">CREATE (p)-[r:ACTED_IN &#123; roles: [&apos;Zachry&apos;]&#125;]-&gt;(m)</div><div class="line">RETURN p,r,m</div></pre></td></tr></table></figure><br><br>更新结点属性,但不确定图中是否存在一个结点时(这样做的代价是开销很大),总之,使用MERGE,它没有找到就会创建.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MERGE (m:Movie &#123; title:&quot;Cloud Atlas&quot; &#125;)</div><div class="line">ON CREATE SET m.released = 2012</div><div class="line">RETURN m</div></pre></td></tr></table></figure><br><br><font color="red">2.4 where语法</font><br>以下两种写法相同<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MATCH (m:Movie)</div><div class="line">WHERE m.title = &quot;The Matrix&quot;</div><div class="line">RETURN m</div></pre></td></tr></table></figure><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MATCH (m:Movie &#123; title: &quot;The Matrix&quot; &#125;)</div><div class="line">RETURN m</div></pre></td></tr></table></figure><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MATCH (p:Person)-[r:ACTED_IN]-&gt;(m:Movie)</div><div class="line">WHERE p.name =~ &quot;K.+&quot; OR m.released &gt; 2000 OR &quot;Neo&quot; IN r.roles</div><div class="line">RETURN p,r,m</div></pre></td></tr></table></figure><br><br>where子句可以用关系来判断<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MATCH (p:Person)-[:ACTED_IN]-&gt;(m)</div><div class="line">WHERE NOT (p)-[:DIRECTED]-&gt;()</div><div class="line">RETURN p,m</div></pre></td></tr></table></figure><br><br>使用别名返回值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MATCH (p:Person)</div><div class="line">RETURN p, p.name AS name, upper(p.name), coalesce(p.nickname,&quot;n/a&quot;) AS nickname, &#123; name: p.name,</div><div class="line">  label:head(labels(p))&#125; AS person</div></pre></td></tr></table></figure><br><br>聚合函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MATCH (:Person)</div><div class="line">RETURN count(*) AS people</div></pre></td></tr></table></figure><br><br>排序和分页<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)</div><div class="line">RETURN a,count(*) AS appearances</div><div class="line">ORDER BY appearances DESC LIMIT 10;</div></pre></td></tr></table></figure><br><br>聚集<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MATCH (m:Movie)&lt;-[:ACTED_IN]-(a:Person)</div><div class="line">RETURN m.title AS movie, collect(a.name) AS cast, count(*) AS actors</div></pre></td></tr></table></figure><br><br>合并两个结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">MATCH (actor:Person)-[r:ACTED_IN]-&gt;(movie:Movie)</div><div class="line">RETURN actor.name AS name, type(r) AS acted_in, movie.title AS title</div><div class="line">UNION</div><div class="line">MATCH (director:Person)-[r:DIRECTED]-&gt;(movie:Movie)</div><div class="line">RETURN director.name AS name, type(r) AS acted_in, movie.title AS title</div></pre></td></tr></table></figure><br><br>with语法保留中间结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MATCH (person:Person)-[:ACTED_IN]-&gt;(m:Movie)</div><div class="line">WITH person, count(*) AS appearances, collect(m.title) AS movies</div><div class="line">WHERE appearances &gt; 1</div><div class="line">RETURN person.name, appearances, movies</div></pre></td></tr></table></figure><br><br>增加约束<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CREATE CONSTRAINT ON (movie:Movie) ASSERT movie.title IS UNIQUE</div></pre></td></tr></table></figure><br><br>创建索引<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CREATE INDEX ON :Actor(name)</div></pre></td></tr></table></figure><br><br><font color="red">2.4 Cypher操作</font>

<p>更新操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MATCH (n &#123;name: &apos;John&apos;&#125;)-[:FRIEND]-(friend)</div><div class="line">WITH n, count(friend) AS friendsCount</div><div class="line">SET n.friendCount = friendsCount</div><div class="line">RETURN n.friendsCount</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5 Cypher语法</font></p>
<p><font color="red">2.5.1 CASE语法</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">MATCH (n)</div><div class="line">RETURN</div><div class="line">CASE n.eyes</div><div class="line">WHEN &apos;blue&apos;</div><div class="line">THEN 1</div><div class="line">WHEN &apos;brown&apos;</div><div class="line">THEN 2</div><div class="line">ELSE 3 END AS result</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">MATCH (n)</div><div class="line">RETURN</div><div class="line">CASE</div><div class="line">WHEN n.eyes = &apos;blue&apos;</div><div class="line">THEN 1</div><div class="line">WHEN n.age &lt; 40</div><div class="line">THEN 2</div><div class="line">ELSE 3 END AS result</div></pre></td></tr></table></figure>
<p><font color="red">2.5.2 带参数查询</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MATCH (n:Person &#123; name: $name &#125;)</div><div class="line">RETURN n</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5.3 定义正则表达式</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MATCH (n:Person)</div><div class="line"># regex在之前定义</div><div class="line">WHERE n.name =~ $regex</div><div class="line">RETURN n.name</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5.4</font><br>用json数据创建结点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;props&quot; : &#123;</div><div class="line"> </div><div class="line">&quot;name&quot; : &quot;Andres&quot;,</div><div class="line"> </div><div class="line">&quot;position&quot; : &quot;Developer&quot;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">CREATE ($props)</div></pre></td></tr></table></figure></p>
<p>用json数据批量创建结点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;props&quot; : [ &#123;</div><div class="line"> </div><div class="line">&quot;awesome&quot; : true,</div><div class="line"> </div><div class="line">&quot;name&quot; : &quot;Andres&quot;,</div><div class="line"> </div><div class="line">&quot;position&quot; : &quot;Developer&quot;</div><div class="line">  &#125;, &#123;</div><div class="line"> </div><div class="line">&quot;children&quot; : 3,</div><div class="line"> </div><div class="line">&quot;name&quot; : &quot;Michael&quot;,</div><div class="line"> </div><div class="line">&quot;position&quot; : &quot;Developer&quot;</div><div class="line">  &#125; ]</div><div class="line">&#125;</div><div class="line"></div><div class="line">UNWIND $props AS properties</div><div class="line">CREATE (n:Person)</div><div class="line">SET n = properties</div><div class="line">RETURN n</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5.5 查询关系(限定跳数)</font><br>a到b的跳数少于7跳<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(a)-[*..7]-&gt;(b)</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5.6 Match</font><br>匹配关系<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 不分方向</div><div class="line">--</div><div class="line"># 带有具体关系</div><div class="line">-[r]-</div><div class="line"># 指向关系</div><div class="line">--&gt;</div><div class="line"># 带有具体关系</div><div class="line">-[r]-&gt;</div></pre></td></tr></table></figure></p>
<p>两点之间最短长度的路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MATCH (martin:Person &#123; name: &apos;Martin Sheen&apos; &#125;),(oliver:Person &#123; name: &apos;Oliver Stone&apos; &#125;), p =</div><div class="line">shortestPath((martin)-[*..15]-(oliver))</div><div class="line">RETURN p</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5.7 直接从CSV文件中批量插入结点数据</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># CSV文件内容:</div><div class="line">&quot;1&quot;,&quot;ABBA&quot;,&quot;1992&quot;</div><div class="line">&quot;2&quot;,&quot;Roxette&quot;,&quot;1986&quot;</div><div class="line">&quot;3&quot;,&quot;Europe&quot;,&quot;1979&quot;</div><div class="line">&quot;4&quot;,&quot;The Cardigans&quot;,&quot;1992&quot;</div><div class="line"></div><div class="line"># query</div><div class="line">LOAD CSV FROM &apos;&#123;csv-dir&#125;/artists.csv&apos; AS line</div><div class="line">CREATE (:Artist &#123; name: line[1], year: toInt(line[2])&#125;)</div></pre></td></tr></table></figure></p>
<p>当CSV文件包含大量数据时,使用USING PERIODIC COMMIT<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">USING PERIODIC COMMIT</div><div class="line">LOAD CSV FROM &apos;&#123;csv-dir&#125;/artists.csv&apos; AS line</div><div class="line">CREATE (:Artist &#123; name: line[1], year: toInt(line[2])&#125;)</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5.7 Set</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 更新属性</div><div class="line">MATCH (peter &#123; name: &apos;Peter&apos; &#125;)</div><div class="line">SET peter += &#123; hungry: TRUE , position: &apos;Entrepreneur&apos; &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 给结点增加标签</div><div class="line">MATCH (n &#123; name: &apos;Stefan&apos; &#125;)</div><div class="line">SET n :German</div><div class="line">RETURN n</div></pre></td></tr></table></figure>
<p><font color="red">2.5.8 Delete</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 删除单节点</div><div class="line">MATCH (n:Useless)</div><div class="line">DELETE n</div><div class="line"></div><div class="line"># 删除一个结点及其所有关系</div><div class="line">MATCH (n &#123; name: &apos;Andres&apos; &#125;)</div><div class="line">DETACH DELETE n</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5.9 Remove</font><br>Remove和Delete不同之处在于,Delete用来删除结点,而Remove用来移除结点的属性和标签.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 移除结点的age属性</div><div class="line">MATCH (n &#123; name: &apos;Peter&apos; &#125;)</div><div class="line">REMOVE n:German</div><div class="line">RETURN n</div></pre></td></tr></table></figure></p>
<p><font color="red">2.5.10 FOREACH</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MATCH p =(begin)-[*]-&gt;(END )</div><div class="line">WHERE begin.name = &apos;A&apos; AND END .name = &apos;D&apos;</div><div class="line">FOREACH (n IN nodes(p)| SET n.marked = TRUE )</div></pre></td></tr></table></figure></p>
<h3 id="3-neo4j-python"><a href="#3-neo4j-python" class="headerlink" title="3.neo4j-python"></a>3.neo4j-python</h3><p>安装驱动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install neo4j-driver==1.1.0</div></pre></td></tr></table></figure></p>
<p>带参更新数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tx.run( &quot;CREATE (person:Person &#123;name: &#123;name&#125;, title: &#123;title&#125;&#125;)&quot;,parameters( &quot;name&quot;, &quot;Arthur&quot;, &quot;title&quot;, &quot;king&quot; ) );</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">result = session.run(&quot;MATCH (weapon:Weapon) WHERE weapon.name CONTAINS &#123;term&#125; &quot;</div><div class="line"> </div><div class="line">&quot;RETURN weapon.name&quot;, &#123;&quot;term&quot;: search_term&#125;)</div></pre></td></tr></table></figure>
<p>保存结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">session = driver.session()</div><div class="line">result = session.run(&quot;MATCH (knight:Person:Knight) WHERE knight.castle = &#123;castle&#125; &quot;</div><div class="line"> </div><div class="line">&quot;RETURN knight.name AS name&quot;, &#123;&quot;castle&quot;: &quot;Camelot&quot;&#125;)</div><div class="line">retained_result = list(result)</div><div class="line">session.close()</div><div class="line">for record in retained_result:</div><div class="line">	print(&quot;%s is a knight of Camelot&quot; % record[&quot;name&quot;])</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://github.com/DuncanZhou/2017/05/10/py2neo/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="duncan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Duncan's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Duncan's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/10/py2neo/" itemprop="url">
                  python与neo-4j交互(对py2neo包做的笔记)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-10T22:50:12+08:00">
                2017-05-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1.连接数据库(三种方式相等)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">graph_1 = Graph()</div><div class="line">graph_2 = Graph(host=&quot;localhost&quot;)</div><div class="line">graph_3 = Graph(&quot;http://localhost:7474/db/data&quot;)</div></pre></td></tr></table></figure></p>
<p>2.事务操作<br>a)直接返回结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">graph.data(&quot;MATCH (a:Person) RETURN a.name, a.born LIMIT 4&quot;)</div></pre></td></tr></table></figure></p>
<p>b)以pandas格式返回结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DataFrame(graph.data(&quot;MATCH (a:Person) RETURN a.name, a.born LIMIT 4&quot;))</div></pre></td></tr></table></figure></p>
<p>事务操作样例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">from py2neo import Graph, Node, Relationship</div><div class="line">g = Graph()</div><div class="line">tx = g.begin()</div><div class="line">a = Node(&quot;Person&quot;, name=&quot;Alice&quot;)</div><div class="line">tx.create(a)</div><div class="line">b = Node(&quot;Person&quot;, name=&quot;Bob&quot;)</div><div class="line">ab = Relationship(a, &quot;KNOWS&quot;, b)</div><div class="line">tx.create(ab)</div><div class="line">tx.commit()</div><div class="line">g.exists(ab)</div></pre></td></tr></table></figure></p>
<p>3.匹配关系<br>查找alice的所有朋友<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">for rel in graph.match(start_node=alice,rel_type=&quot;FRIEND&quot;):</div><div class="line">	print(rel.end_node()[&apos;name&apos;])</div></pre></td></tr></table></figure></p>
<p>4.带参数查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">from py2neo import Graph</div><div class="line">g = Graph()</div><div class="line"># evaluate()返回结果的第一个值</div><div class="line">g.run(&quot;&quot;MATCH (a) WHERE a.email=&#123;x&#125; RETURN a.name&quot;,x=&quot;bob@acme.com&quot;).evaluate()</div><div class="line">g.run(&quot;&quot;MATCH (a) WHERE a.email=&#123;x&#125; RETURN a.name&quot;,x=&quot;bob@acme.com&quot;).data()</div></pre></td></tr></table></figure></p>
<p>5.NodeSelector使用,可以使用Cypher语言的where部分<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">from py2neo import Graph,NodeSelector</div><div class="line">graph = Graph()</div><div class="line">selector = NodeSelector(graph)</div><div class="line">slected = selector.select(&quot;Person&quot;,name=&quot;Keanu Reeves&quot;)</div><div class="line">list(selected)</div><div class="line">selected = selector.select(&quot;Person&quot;).where(&quot;_.name =~ &apos;J.*&apos;&quot;,&quot;1960 &lt;= _.born &lt; 1970&quot;)</div><div class="line">list(selected)</div></pre></td></tr></table></figure></p>
<p>6.删除操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 删除所有的</div><div class="line">graph.delete_all()</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ww1.sinaimg.cn/large/0060lm7Tgw1fakgrchk2xj303d03dmx4.jpg"
               alt="duncan" />
          <p class="site-author-name" itemprop="name">duncan</p>
          <p class="site-description motion-element" itemprop="description">write something useful</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">duncan</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
